---
title: "NFL Player Longevity Trends and Insights"
author: "Lyle Huth"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(ggfortify)
library(broom)
library(ggrepel)
library(kableExtra)
library(ggplot2)
library(ggtext)
library(kableExtra)
library(dplyr)
library(knitr)
library(skimr)
```

```{r}
file_list <- list.files(path = "2430_csv_files", pattern = "*.csv", full.names = TRUE)
my_data <- lapply(file_list, read.csv)

names(my_data) <- c("basic_stats", 
                    "career_defense", 
                    "career_passing", 
                    "career_punting", 
                    "career_receiving", 
                    "career_rushing", 
                    "injuries")

basic_stats <- my_data$basic_stats
career_defense <- my_data$career_defense
career_passing <- my_data$career_passing
career_punting <- my_data$career_punting
career_receiving <- my_data$career_receiving
career_rushing <- my_data$career_rushing
injuries <- my_data$injuries

glimpse(basic_stats)

```

```{r}
basic_stats_filtered <- basic_stats %>%
  mutate(position_grouped = case_when(
    Position %in% c("QB", "RB", "WR", "TE", "K") ~ Position,
    Position %in% c("CB", "S", "LB", "ILB", "OLB", "SS", "FS", "DT", "DE", "DB", "NT", "DL") ~ "DEF",
    TRUE ~ NA_character_
  )) %>%
  filter(!is.na(position_grouped))

ggplot(basic_stats_filtered, aes(x = position_grouped)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Player Count by Position",
       x = "Position", y = "Number of Players") +
  theme_minimal()
```
```{r}

basic_stats_cleaned <- basic_stats %>%
  mutate(
    career_length = case_when(
      str_detect(Experience, "Rookie") ~ 0, # If the experience is "rookie", meaning it is the player's first season, set their career length to zero.
      TRUE ~ parse_number(Experience)
    ), # Convert "Last, First" -> "First Last"
    name_clean = str_to_lower(str_trim(str_replace(Name, "^(.*),\\s*(.*)$", "\\2 \\1")))
  )

injury_seasons <- injuries %>%
  mutate(name_clean = str_to_lower(str_trim(full_name))) %>%
  group_by(name_clean) %>%
  summarise(injury_seasons = n_distinct(season))

career_injury_comparison <- basic_stats_cleaned %>%
  select(name_clean, career_length) %>%
  left_join(injury_seasons, by = "name_clean") %>%
  mutate(
    injury_seasons = replace_na(injury_seasons, 0),
    career_length = replace_na(career_length, 0)
  )

ggplot(career_injury_comparison, aes(x = career_length, y = injury_seasons)) +
  geom_point(alpha = 0.6, color = "darkgreen") +
  geom_smooth(method = "lm", se = FALSE, color = "firebrick") +
  labs(
    title = "Career Length vs Seasons with Reported Injuries",
    x = "Career Length (Years)",
    y = "Number of Seasons Injured"
  ) +
  theme_minimal()

#Hmmm, regression is positive but logically that doesn't make much sense... how else could we show this? (box plot?)
```

```{r}
basic_stats_cleaned %>%
  filter(career_length == 25) %>%
  select(Name)
# Morten Anderson - NFL record holder for games played, points (2544), and field goals (565).
#Kicker
```
---
title: "NFL Player Longevity Trends and Insights"
author: "Lyle Huth"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(ggfortify)
library(broom)
library(ggrepel)
library(kableExtra)
library(ggplot2)
library(ggtext)
library(kableExtra)
library(dplyr)
library(knitr)
library(skimr)
```
##Introduction 
In this Data report we use data from seven different datasets, they look at a player's career statistics by season at each relevent position, their indivual stats including their height, weight, and years played in the NFL. Lastly their reported injuries over the years.

*Gonna install some kind of cover image here to go with our report

Main Research Question:

How do injuries impact the career length of NFL players, and are certain positions or player builds more prone to injury?
This question will be explored using various datasets that include information on player height, weight, position, and age.

To go deeper into this topic, the following questions will also be looked at:

How long do players typically last at each position, and what factors contribute to shorter careers?
How does a player's physical build within a given position influence their susceptibility to injuries and, in comparison, their willingness to absorb contact?

These questions offer a clear framework for analyzing our large dataset, helping us uncover trends in player health and their ability to sustain long-term careers in the NFL.

##Data
1. Overview
This analysis is based on seven .csv datasets related to NFL player careers and injuries. Five of the datasets provide season-by-season statistics for players at key positions: quarterback, running back, wide receiver, defensive player, and punter. The sixth dataset contains player background information, including height, weight, and total years played in the NFL. The seventh and final dataset includes reported injury records spanning several years.
2. Source
The data was collected by the NFL and its official analytics partner, Next Gen Stats, using comprehensive tracking and recording systems. These datasets represent an exhaustive sample of NFL players throughout the league’s history. 
3. Variables & Descriptions

| Variable         | Description                                | Units          | Type                          |
|------------------|--------------------------------------------|----------------|-------------------------------|
| position         | Player's on-field role                     | –              | Categorical (QB, RB, WR, etc.)|
| height           | Player height                              | feet + inches  | Numeric                       |
| weight           | Player weight                              | pounds         | Numeric                       |
| career_length    | Total seasons in NFL                       | years          | Numeric                       |
| passing_yards    | Total passing yards (QBs)                  | yards          | Numeric (position-specific)   |
| passing_attempts | Total passing attempts                     | count          | Numeric                       |
| injury_duration  | Games/weeks missed due to injury           | games/weeks    | Numeric                       |
| weight           | Player weight                              | pounds         | Numeric                       |
| career_length    | Total seasons in NFL                       | years          | Numeric                       |
| passing_yards    | Total passing yards (for QBs)              | yards          | Numeric (position-specific)   |
| injury_type      | Body part or type of injury                | –              | Categorical                   |
| injury_duration  | Games/weeks missed due to injury           | games/weeks    | Numeric        





```{r}
file_list <- list.files(path = "2430_csv_files", pattern = "*.csv", full.names = TRUE)
my_data <- lapply(file_list, read.csv)

names(my_data) <- c("basic_stats", 
                    "career_defense", 
                    "career_passing", 
                    "career_punting", 
                    "career_receiving", 
                    "career_rushing", 
                    "injuries")

basic_stats <- my_data$basic_stats
career_defense <- my_data$career_defense
career_passing <- my_data$career_passing
career_punting <- my_data$career_punting
career_receiving <- my_data$career_receiving
career_rushing <- my_data$career_rushing
injuries <- my_data$injuries

glimpse(basic_stats)

```

```{r}
basic_stats_filtered <- basic_stats %>%
  mutate(position_grouped = case_when(
    Position %in% c("QB", "RB", "WR", "TE", "K") ~ Position,
    Position %in% c("CB", "S", "LB", "ILB", "OLB", "SS", "FS", "DT", "DE", "DB", "NT", "DL") ~ "DEF",
    TRUE ~ NA_character_
  )) %>%
  filter(!is.na(position_grouped))

ggplot(basic_stats_filtered, aes(x = position_grouped)) +
  geom_bar(fill = "steelblue") +
  labs(title = "Player Count by Position",
       x = "Position", y = "Number of Players") +
  theme_minimal()
```
```{r}

basic_stats_cleaned <- basic_stats %>%
  mutate(
    career_length = case_when(
      str_detect(Experience, "Rookie") ~ 0, # If the experience is "rookie", meaning it is the player's first season, set their career length to zero.
      TRUE ~ parse_number(Experience)
    ), # Convert "Last, First" -> "First Last"
    name_clean = str_to_lower(str_trim(str_replace(Name, "^(.*),\\s*(.*)$", "\\2 \\1")))
  )

injury_seasons <- injuries %>%
  mutate(name_clean = str_to_lower(str_trim(full_name))) %>%
  group_by(name_clean) %>%
  summarise(injury_seasons = n_distinct(season))

career_injury_comparison <- basic_stats_cleaned %>%
  select(name_clean, career_length) %>%
  left_join(injury_seasons, by = "name_clean") %>%
  mutate(
    injury_seasons = replace_na(injury_seasons, 0),
    career_length = replace_na(career_length, 0)
  )

ggplot(career_injury_comparison, aes(x = career_length, y = injury_seasons)) +
  geom_point(alpha = 0.6, color = "darkgreen") +
  geom_smooth(method = "lm", se = FALSE, color = "firebrick") +
  labs(
    title = "Career Length vs Seasons with Reported Injuries",
    x = "Career Length (Years)",
    y = "Number of Seasons Injured"
  ) +
  theme_minimal()

#Hmmm, regression is positive but logically that doesn't make much sense... how else could we show this? (box plot?)
```

```{r}
basic_stats_cleaned %>%
  filter(career_length == 25) %>%
  select(Name)
# Morten Anderson - NFL record holder for games played, points (2544), and field goals (565).
#Kicker
```
